{"ast":null,"code":"import Keycloak from 'keycloak-js';\nimport { reactive, toRefs } from 'vue';\nimport jwtDecode from 'jwt-decode';\nconst state = reactive({\n  isAuthenticated: false,\n  hasFailed: false,\n  isPending: false,\n  token: '',\n  decodedToken: {},\n  username: '',\n  roles: []\n});\nconst setToken = token => {\n  state.token = token;\n  const content = jwtDecode(state.token);\n  state.decodedToken = content;\n  state.roles = content.realm_access.roles;\n  state.username = content.preferred_username;\n};\nconst hasFailed = value => {\n  state.hasFailed = value;\n};\nconst isPending = value => {\n  state.isPending = value;\n};\nconst isAuthenticated = value => {\n  state.isAuthenticated = value;\n};\n\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types, @typescript-eslint/no-explicit-any\nfunction isPromise(promise) {\n  return !isNil(promise) && typeof promise.then === 'function';\n}\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types, @typescript-eslint/no-explicit-any\nfunction isFunction(fun) {\n  return !isNil(fun) && typeof fun === 'function';\n}\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types, @typescript-eslint/no-explicit-any\nfunction isString(text) {\n  return !isNil(text) && (typeof text === 'string' || text instanceof String);\n}\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types, @typescript-eslint/no-explicit-any\nfunction isNil(value) {\n  return value === undefined || value === null;\n}\nlet $keycloak = undefined;\nasync function isTokenReady() {\n  return new Promise(resolve => checkToken(resolve));\n}\nconst checkToken = resolve => {\n  if (!isNil($keycloak) && !isNil($keycloak.token)) {\n    resolve();\n  } else {\n    setTimeout(() => checkToken(resolve), 500);\n  }\n};\nfunction getKeycloak() {\n  return $keycloak;\n}\nasync function getToken() {\n  return updateToken();\n}\nasync function updateToken() {\n  if (!$keycloak) {\n    throw new Error('Keycloak is not initialized.');\n  }\n  try {\n    await $keycloak.updateToken(10);\n    setToken($keycloak.token);\n  } catch (error) {\n    hasFailed(true);\n    throw new Error('Failed to refresh the token, or the session has expired');\n  }\n  return $keycloak.token;\n}\nfunction createKeycloak(config) {\n  $keycloak = Keycloak(config);\n  return getKeycloak();\n}\nasync function initKeycloak(initConfig) {\n  try {\n    isPending(true);\n    const _isAuthenticated = await $keycloak.init(initConfig);\n    isAuthenticated(_isAuthenticated);\n    if (!isNil($keycloak.token)) {\n      setToken($keycloak.token);\n    }\n    $keycloak.onAuthRefreshSuccess = () => setToken($keycloak.token);\n    $keycloak.onTokenExpired = () => updateToken();\n  } catch (error) {\n    hasFailed(true);\n    isAuthenticated(false);\n    throw new Error('Could not read access token');\n  } finally {\n    isPending(false);\n  }\n}\nconst useKeycloak = () => {\n  return Object.assign(Object.assign({}, toRefs(state)), {\n    keycloak: getKeycloak(),\n    hasRoles: roles => !isNil(roles) && state.isAuthenticated && roles.every(role => state.roles.includes(role))\n  });\n};\nconst defaultInitConfig = {\n  flow: 'standard',\n  checkLoginIframe: false,\n  onLoad: 'login-required'\n};\nfunction loadJsonConfig(url) {\n  return new Promise((resolve, reject) => {\n    const xhttp = new XMLHttpRequest();\n    xhttp.overrideMimeType('application/json');\n    xhttp.onreadystatechange = function () {\n      if (this.readyState === 4) {\n        if (200 <= this.status && this.status <= 400) {\n          const jsonResponse = this.responseText;\n          const response = JSON.parse(jsonResponse);\n          resolve(response);\n        } else {\n          reject('Could not load ' + url + ' file');\n        }\n      }\n    };\n    xhttp.open('GET', url, true);\n    xhttp.send();\n  });\n}\nconst vueKeycloak = {\n  async install(app, options) {\n    if (isNil(options)) {\n      throw new Error('The Keycloak.KeycloakConfig are requried');\n    }\n    let keycloakPluginConfig;\n    if (isString(options)) {\n      keycloakPluginConfig = await loadJsonConfig(options);\n    } else if (isPromise(options) || isFunction(options)) {\n      keycloakPluginConfig = await options();\n    } else {\n      keycloakPluginConfig = options;\n    }\n    const keycloakConfig = keycloakPluginConfig.config;\n    const keycloakInitOptions = !isNil(keycloakPluginConfig.initOptions) ? Object.assign(Object.assign({}, defaultInitConfig), keycloakPluginConfig.initOptions) : defaultInitConfig;\n    const _keycloak = createKeycloak(keycloakConfig);\n    app.config.globalProperties.$keycloak = _keycloak;\n    await initKeycloak(keycloakInitOptions);\n  }\n};\nexport { getKeycloak, getToken, isTokenReady, useKeycloak, vueKeycloak };","map":{"version":3,"names":["state","reactive","isAuthenticated","hasFailed","isPending","token","decodedToken","username","roles","setToken","content","jwtDecode","realm_access","preferred_username","value","isPromise","promise","isNil","then","isFunction","fun","isString","text","String","undefined","$keycloak","isTokenReady","Promise","resolve","checkToken","setTimeout","getKeycloak","getToken","updateToken","Error","error","createKeycloak","config","Keycloak","initKeycloak","initConfig","_isAuthenticated","init","onAuthRefreshSuccess","onTokenExpired","useKeycloak","Object","assign","toRefs","keycloak","hasRoles","every","role","includes","defaultInitConfig","flow","checkLoginIframe","onLoad","loadJsonConfig","url","reject","xhttp","XMLHttpRequest","overrideMimeType","onreadystatechange","readyState","status","jsonResponse","responseText","response","JSON","parse","open","send","vueKeycloak","install","app","options","keycloakPluginConfig","keycloakConfig","keycloakInitOptions","initOptions","_keycloak","globalProperties"],"sources":["../dist-transpiled/state.js","../dist-transpiled/utils.js","../dist-transpiled/keycloak.js","../dist-transpiled/composable.js","../dist-transpiled/const.js","../dist-transpiled/config.js","../dist-transpiled/plugin.js"],"sourcesContent":["import { reactive } from 'vue';\nimport jwtDecode from 'jwt-decode';\nexport const state = reactive({\n    isAuthenticated: false,\n    hasFailed: false,\n    isPending: false,\n    token: '',\n    decodedToken: {},\n    username: '',\n    roles: [],\n});\nexport const setToken = (token) => {\n    state.token = token;\n    const content = jwtDecode(state.token);\n    state.decodedToken = content;\n    state.roles = content.realm_access.roles;\n    state.username = content.preferred_username;\n};\nexport const hasFailed = (value) => {\n    state.hasFailed = value;\n};\nexport const isPending = (value) => {\n    state.isPending = value;\n};\nexport const isAuthenticated = (value) => {\n    state.isAuthenticated = value;\n};\n//# sourceMappingURL=state.js.map","// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types, @typescript-eslint/no-explicit-any\nexport function isPromise(promise) {\n    return !isNil(promise) && typeof promise.then === 'function';\n}\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types, @typescript-eslint/no-explicit-any\nexport function isFunction(fun) {\n    return !isNil(fun) && typeof fun === 'function';\n}\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types, @typescript-eslint/no-explicit-any\nexport function isString(text) {\n    return !isNil(text) && (typeof text === 'string' || text instanceof String);\n}\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types, @typescript-eslint/no-explicit-any\nexport function isNil(value) {\n    return value === undefined || value === null;\n}\n//# sourceMappingURL=utils.js.map","import Keycloak from 'keycloak-js';\nimport { hasFailed, isAuthenticated, isPending, setToken } from './state';\nimport { isNil } from './utils';\nlet $keycloak = undefined;\nexport async function isTokenReady() {\n    return new Promise(resolve => checkToken(resolve));\n}\nconst checkToken = (resolve) => {\n    if (!isNil($keycloak) && !isNil($keycloak.token)) {\n        resolve();\n    }\n    else {\n        setTimeout(() => checkToken(resolve), 500);\n    }\n};\nexport function getKeycloak() {\n    return $keycloak;\n}\nexport async function getToken() {\n    return updateToken();\n}\nexport async function isLoggedIn() {\n    try {\n        if (!$keycloak.authenticated) {\n            return false;\n        }\n        await this.updateToken();\n        return true;\n    }\n    catch (error) {\n        return false;\n    }\n}\nexport async function updateToken() {\n    if (!$keycloak) {\n        throw new Error('Keycloak is not initialized.');\n    }\n    try {\n        await $keycloak.updateToken(10);\n        setToken($keycloak.token);\n    }\n    catch (error) {\n        hasFailed(true);\n        throw new Error('Failed to refresh the token, or the session has expired');\n    }\n    return $keycloak.token;\n}\nexport function createKeycloak(config) {\n    $keycloak = Keycloak(config);\n    return getKeycloak();\n}\nexport async function initKeycloak(initConfig) {\n    try {\n        isPending(true);\n        const _isAuthenticated = await $keycloak.init(initConfig);\n        isAuthenticated(_isAuthenticated);\n        if (!isNil($keycloak.token)) {\n            setToken($keycloak.token);\n        }\n        $keycloak.onAuthRefreshSuccess = () => setToken($keycloak.token);\n        $keycloak.onTokenExpired = () => updateToken();\n    }\n    catch (error) {\n        hasFailed(true);\n        isAuthenticated(false);\n        throw new Error('Could not read access token');\n    }\n    finally {\n        isPending(false);\n    }\n}\n//# sourceMappingURL=keycloak.js.map","import { toRefs } from 'vue';\nimport { getKeycloak } from './keycloak';\nimport { state } from './state';\nimport { isNil } from './utils';\nexport const useKeycloak = () => {\n    return Object.assign(Object.assign({}, toRefs(state)), { keycloak: getKeycloak(), hasRoles: (roles) => !isNil(roles) && state.isAuthenticated && roles.every(role => state.roles.includes(role)) });\n};\n//# sourceMappingURL=composable.js.map","export const defaultInitConfig = {\n    flow: 'standard',\n    checkLoginIframe: false,\n    onLoad: 'login-required',\n};\n//# sourceMappingURL=const.js.map","export function loadJsonConfig(url) {\n    return new Promise((resolve, reject) => {\n        const xhttp = new XMLHttpRequest();\n        xhttp.overrideMimeType('application/json');\n        xhttp.onreadystatechange = function () {\n            if (this.readyState === 4) {\n                if (200 <= this.status && this.status <= 400) {\n                    const jsonResponse = this.responseText;\n                    const response = JSON.parse(jsonResponse);\n                    resolve(response);\n                }\n                else {\n                    reject('Could not load ' + url + ' file');\n                }\n            }\n        };\n        xhttp.open('GET', url, true);\n        xhttp.send();\n    });\n}\n//# sourceMappingURL=config.js.map","import { defaultInitConfig } from './const';\nimport { createKeycloak, initKeycloak } from './keycloak';\nimport { isPromise, isFunction, isNil, isString } from './utils';\nimport { loadJsonConfig } from './config';\nexport const vueKeycloak = {\n    async install(app, options) {\n        if (isNil(options)) {\n            throw new Error('The Keycloak.KeycloakConfig are requried');\n        }\n        let keycloakPluginConfig;\n        if (isString(options)) {\n            keycloakPluginConfig = await loadJsonConfig(options);\n        }\n        else if (isPromise(options) || isFunction(options)) {\n            keycloakPluginConfig = await options();\n        }\n        else {\n            keycloakPluginConfig = options;\n        }\n        const keycloakConfig = keycloakPluginConfig.config;\n        const keycloakInitOptions = !isNil(keycloakPluginConfig.initOptions)\n            ? Object.assign(Object.assign({}, defaultInitConfig), keycloakPluginConfig.initOptions) : defaultInitConfig;\n        const _keycloak = createKeycloak(keycloakConfig);\n        app.config.globalProperties.$keycloak = _keycloak;\n        await initKeycloak(keycloakInitOptions);\n    },\n};\n//# sourceMappingURL=plugin.js.map"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}